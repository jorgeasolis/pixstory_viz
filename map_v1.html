<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">

        <title>Pixstory Explorer</title>

        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

        <!-- Latest compiled JavaScript -->
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

        <!-- Custom CSS -->
        <link href="css/styles.css" rel="stylesheet">

    </head>
    <body>
        <div id="header" style="margin-bottom:5%"></div>

        <div class="container">

            <nav class="navbar navbar-default navbar-static-top">
                <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                    <li><a style="color:#fff" href="index.html">Main</a></li>
                    <li class="active"><a style="color:#fff" href="#">Map</a></li>
                    <li><a style="color:#fff" href="map2.html">Map 2</a></li>
                    <li><a style="color:#fff" href="#">BF Cross Correlation</a></li>
                    <li><a style="color:#fff" href="#">FHT</a></li>
                    <li><a style="color:#fff" href="#">Mime Diversity</a></li>
                    </ul>
                </div>
                </div>
            </nav>

            
            <div class="container-fluid">
                <div class="row">
                    <div id="tooltip"></div>
                    <svg width="576" height="360" id="statesvg"></svg>
                </div>
            </div>

            <footer class="footer">
                <div class="container" style="text-align: center;">
                    <p class="text-muted">Team 1 - Spring2023</p>
                </div>
            </footer>
  
        </div>

        <script src="js/uStates.js"></script>
        <script src="js/d3.min.js"></script>
        <script src="js/jquery-1.12.1.min.js"></script>

        <script>
            //set the global variables
            var option = "image"; // this is the default option
            
            function buttonClick(e) {
                option = $(e).attr('value');
                $('#buttons button').removeClass('active');
                $('#buttons button[value="' + option + '"]').addClass('active');
            }

            function tooltipHtml(n, d) { /* function to create html content string in tooltip div. */
                var tooltipData = "<h4>" + n + "</h4><table>";
                var plainCount = d['Posts'];
                if (plainCount == undefined) {
                    plainCount = '0';
                }

                tooltipData += "<tr><td> Number of posts: </td><td>" +"\ "+ plainCount + "</td></tr>";
                tooltipData += "</table";
                return tooltipData;
            }

            var data = {};
            var maxCount = 0;
            /*d3.json("data/us_state_map_data.json", function(error, mapJson) {*/
            d3.json("data/test.json", function(error, mapJson) {
                if (error) throw error;
                $.each(mapJson, function(i, stateObject) {
                    var countPerState = 0;
                    $.each(stateObject, function(i, count) {
                        countPerState += count;
                    });
                    if (countPerState > maxCount) {
                        maxCount = countPerState;
                    }
                });

                $.each(mapJson, function(i, stateObject) {
                    var countPerState = 0;
                    $.each(stateObject, function(i, count) {
                        countPerState += count;
                    });
                    //stateObject["color"] = d3.interpolate("#ffffcc", "#800026")(countPerState / maxCount);
                    stateObject["color"] = d3.interpolate("#9dfcc3", "#02149c")(countPerState / maxCount);
                    mapJson[i] = stateObject;
                });

                /* draw states on id #statesvg */
                ["HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
                    "ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY", "OH",
                    "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ", "NV", "UT",
                    "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS", "IN", "IL", "MN",
                    "WI", "MO", "AR", "OK", "KS", "LS", "VA"
                ]
                .forEach(function(d) {
                    if (mapJson.hasOwnProperty(d)) {
                        data[d] = mapJson[d];
                    } else {
                        data[d] = {
                            "Content-Type": "NA",
                            "color": "#000000"
                        };
                    }
                });
                uStates.draw("#statesvg", data, tooltipHtml);
            });

        </script>

    </body>
</html>
